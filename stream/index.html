<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mi cat√°logo</title>
  <link rel="stylesheet" href="stream.css" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#1f1f1f">
  <link rel="icon" href="x=.png" />
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>
</head>
<body>

<header>
  <h1>üé¨ Mi cat√°logo</h1>
</header>

<nav>
  <input type="text" id="search" placeholder="Buscar..." />
  <select id="platform">
    <option value="">Plataforma</option>
    <option value="Netflix">Netflix</option>
    <option value="Disney+">Disney+</option>
    <option value="YouTube">YouTube</option>
  </select>
  <select id="genre">
    <option value="">G√©nero</option>
    <option value="28">Acci√≥n</option>
    <option value="35">Comedia</option>
    <option value="18">Drama</option>
  </select>
  <select id="year">
    <option value="">A√±o</option>
    <script>
      for (let y = 2025; y >= 2000; y--) {
        document.write(`<option value="${y}">${y}</option>`);
      }
    </script>
  </select>
</nav>

<main id="results">‚è≥ Cargando...</main>
<div class="center">
  <button id="loadMore">üîÅ Ver m√°s</button>
</div>

<footer>¬© 2025 equisx01</footer>

<script>
const TMDB_API = "6f712d2bf184acc19c28200f263b5220";
let allData = [], page = 1, index = 0, chunk = 4;

const results = document.getElementById("results");
const loadMoreBtn = document.getElementById("loadMore");
const searchInput = document.getElementById("search");

function renderChunk() {
  const slice = allData.slice(index, index + chunk);
  for (const item of slice) {
    const title = item.title || item.name;
    const img = item.poster_path ? `https://image.tmdb.org/t/p/w342${item.poster_path}` : '';
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${img}" alt="${title}">
      <h2>${title}</h2>
      <p>${(item.release_date || item.first_air_date || '').split('-')[0] || ''}</p>
      <a href="detalle.html?title=${encodeURIComponent(title)}">Ver m√°s</a>
    `;
    results.appendChild(card);
  }
  index += chunk;
  if (index >= allData.length) loadMoreBtn.style.display = "none";
}

async function fetchData() {
  results.innerHTML = "‚è≥ Cargando...";
  const res = await fetch(`https://api.themoviedb.org/3/trending/all/week?api_key=${TMDB_API}&language=es-MX&page=${page}`);
  const data = await res.json();
  allData = data.results;
  index = 0;
  results.innerHTML = "";
  renderChunk();
}

loadMoreBtn.onclick = renderChunk;

searchInput.addEventListener("input", async (e) => {
  const q = e.target.value.trim();
  if (q.length < 3) return;
  const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${TMDB_API}&query=${q}&language=es-MX`);
  const data = await res.json();
  allData = data.results;
  index = 0;
  results.innerHTML = "";
  renderChunk();
});

fetchData();
</script>

</body>
</html>